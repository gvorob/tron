<!DOCTYPE html>
<html>
<head>
<style>
#debug {
	border-style: solid;
	border-width: 1px;	
	float: left;
}
canvas {
	border-style: solid;
	border-width: 1px;
	background-color: #EEE;
	float: left;
	clear: left;
}

#ui{
	margin-left: 30px;
	width: 200px;
	float: left;
}

.row{
	float: left;
}

.num_input{
	width: 50px;
	float: left;
}
</style>
<meta charset="utf-8"/>
</head>
<body>
<canvas id="main_canvas" width="1000" height="800"></canvas>

<div id="ui">
	<div>
		<input id="pauseButton" value="Play" type="button" onclick="Wrapper.playPause()"/>
	</div>
	<input value="Clear" type="button" onclick="Wrapper.clear()"/>
	<div id="resize">
		<form id="xy_resize_form">
			<input class="num_input x" value="24" type="number"/>
			<input class="num_input y" value="24" type="number"/>
		</form>
	</div>
	<div>
		<input class="row" type="button" value="exportRLE" onclick="document.getElementById('RLEbox').value = Wrapper.grid.exportRLE()"/>
		<input class="row" type="button" value="importRLE" onclick="Wrapper.grid.importRLE(document.getElementById('RLEbox').value)"/>
	</div>
	<textarea id="RLEbox"></textarea>
</div>

<script type="text/javascript" src="jquery-1.12.1.js"></script>
<script type="text/javascript" src="vector.js"></script>
<script type="text/javascript" src="tron.js"></script>
<script type="text/javascript">

console.log("Loading main js...")

var CONSTANTS = {};
CONSTANTS.pixelsperunit = 64;
var UI = {};

//get/set x/y val as a vector
function xyFormVal(formObj, vect_val) {
	if(formObj == null) { throw "Null ptr in xyFormVal";}
	if(vect_val === undefined) {
		return new Vector(
			0|formObj.find("input.x").val(),
			0|formObj.find("input.y").val());
	} else {
			formObj.find("input.x").val(vect_val.x);
			formObj.find("input.y").val(vect_val.y);
	}
}

function init() {
	UI.canvas = $("canvas#main_canvas");
	UI.canvas.click(function(event){
		var rect = UI.canvas[0].getBoundingClientRect();
		var x = event.clientX - rect.left;
		var y = event.clientY - rect.top;
		Wrapper.doClick(new Vector(x, y));
	});
	UI.canvas.mousemove(function(event){
		var rect = UI.canvas[0].getBoundingClientRect();
		var x = event.clientX - rect.left;
		var y = event.clientY - rect.top;
		Wrapper.doMove(new Vector(x, y));
	});
	UI.canvas.mouseout(function(event){
		Wrapper.doMouseOut();
	});

	UI.resize_form = $("form#xy_resize_form");
	UI.resize_form.change(function(event){
		var success = Wrapper.tryResize(xyFormVal(UI.resize_form));
		if(!success) //If failed, reset input back to actual size
			{ xyFormVal(UI.resize_form, Wrapper.getGridSize()); }
	});

	console.log("Running code...")

	var g = UI.canvas[0].getContext("2d");
	
	Wrapper.init(new Grid(new Vector(10, 10)), UI.canvas[0], 16)

	//Init all options to their actual values
	xyFormVal(UI.resize_form, Wrapper.getGridSize());
}


console.log("Done");


$(document).ready(init);
</script>

</body>
</html>

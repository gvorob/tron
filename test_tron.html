<!DOCTYPE html>
<html>
<head>
<style>
#debug {
	border-style: solid;
	border-width: 1px;	
	float: left;
}
canvas {
	border-style: solid;
	border-width: 1px;
	background-color: #EEE;
	float: left;
	clear: left;
}

#ui{
	margin-left: 30px;
	width: 200px;
	float: left;
}

div.ui_group {
	border-width: 1px;
	border-color: black;
	border-style: solid;
	margin: 4px;
	padding: 4px;
}

.float{
	float: left;
}

input.num_input{
	width: 50px;
}

.num_input input{
	width: 50px;
}
</style>
<meta charset="utf-8"/>
</head>
<body>
<canvas id="main_canvas" width="1000" height="800"></canvas>

<div id="ui">
	<div class="ui_group">
		<input id="pauseButton" value="Play" type="button" onclick="Wrapper.playPause()"/>
		<input value="Clear" type="button" onclick="Wrapper.clear()"/>
	</div>
	<div id="resize" class="ui_group">
		<form id="xy_resize">
			<div class="">Resize grid: </div>
			<div class="num_input"> x <input class="x" type="number"/> </div>
			<div class="num_input"> y <input class="y" type="number"/> </div>
		</form>
	</div>
	<div id="rle" class="ui_group">
		<div>
			<input class="" type="button" id="rle_export" value="export RLE" />
			<input class="" type="button" id="rle_import" value="import RLE" />
		</div>
		<textarea id="rle_data"></textarea>
	</div>
	<div class="ui_group">
		<div> Cell size: <input id="cellsize" class="num_input" type="number"/></div>
	</div>
</div>

<script type="text/javascript" src="jquery-1.12.1.js"></script>
<script type="text/javascript" src="vector.js"></script>
<script type="text/javascript" src="tron.js"></script>
<script type="text/javascript">

console.log("Loading main js...")

var CONSTANTS = {};
CONSTANTS.pixelsperunit = 64;
var UI = {};

//get/set x/y val as a vector
function xyFormProp(formObj, vect_val) {
	if(formObj == null) { throw "Null ptr in xyFormProp";}
	if(vect_val === undefined) {  //Getter
		return new Vector(
			0|formObj.find("input.x").val(),
			0|formObj.find("input.y").val());
	} else {                      //Setter
			formObj.find("input.x").val(vect_val.x);
			formObj.find("input.y").val(vect_val.y);
	}
}

function inputProp(inputObj, form_val) {
	if(inputObj == null) { throw "Null ptr in inputProp";}
	if(form_val === undefined) {  //Getter
		return 0|inputObj.val();
	} else {                      //Setter
		inputObj.val(form_val);
	}
}

//Returns a vector with canvas click coords
function getCanvasClick(j_canvas, event) {
	var rect = UI.canvas[0].getBoundingClientRect();
	var x = event.clientX - rect.left;
	var y = event.clientY - rect.top;
	return new Vector(x, y);
}

function init() {
	UI.canvas = $("canvas#main_canvas");
	UI.resize_form = $("form#xy_resize");
	UI.cellsize_input = $("input#cellsize");
	UI.rle_import_input = $("input#rle_import");
	UI.rle_export_input = $("input#rle_export");
	UI.rle_data = $("textarea#rle_data");

	//Setup canvas mouse events
	UI.canvas.click(function(event){
		Wrapper.doClick(getCanvasClick(UI.canvas, event));});
	UI.canvas.mousemove(function(event){
		Wrapper.doMove(getCanvasClick(UI.canvas, event));});
	UI.canvas.mouseout(function(event){
		Wrapper.doMouseOut();});

	//Setup option UI events
	UI.rle_import_input.click(function(event) {
		Wrapper.importRLE(UI.rle_data.val());});
	UI.rle_export_input.click(function(event) {
		UI.rle_data.val(Wrapper.exportRLE());});
	UI.resize_form.change(function(event){
		var rval = Wrapper.gridSizeProp(xyFormProp(UI.resize_form));
		xyFormProp(UI.resize_form, rval);
	});

	UI.cellsize_input.change(function(event){
		UI.cellsize_input.val(Wrapper.cellSizeProp(UI.cellsize_input.val()));
	});

	console.log("Running code...")

	//Create grid
	Wrapper.init(new Grid(new Vector(10, 10)), UI.canvas[0], 16)

	//Init all options to their actual values
	xyFormProp(UI.resize_form, Wrapper.gridSizeProp());
	inputProp(UI.cellsize_input, 8);
}


console.log("Done");


$(document).ready(init);
</script>

</body>
</html>
